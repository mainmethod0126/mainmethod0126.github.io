import { Callout } from "nextra/components";

# ì—°ê´€ê´€ê³„ ë§¤í•‘ ê¸°ì´ˆ

## ëª©í‘œ

â€¢ ê°ì²´ì™€ í…Œì´ë¸” ì—°ê´€ê´€ê³„ì˜ ì°¨ì´ë¥¼ ì´í•´
â€¢ ê°ì²´ì˜ ì°¸ì¡°ì™€ í…Œì´ë¸”ì˜ ì™¸ë˜ í‚¤ë¥¼ ë§¤í•‘
â€¢ ìš©ì–´ ì´í•´
â€¢ **ë°©í–¥(Direction)**: ë‹¨ë°©í–¥, ì–‘ë°©í–¥
â€¢ **ë‹¤ì¤‘ì„±(Multiplicity)**: ë‹¤ëŒ€ì¼(N:1), ì¼ëŒ€ë‹¤(1:N), ì¼ëŒ€ì¼(1:1),
ë‹¤ëŒ€ë‹¤(N:M) ì´í•´
â€¢ **ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸(Owner)**: ê°ì²´ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ëŠ” ê´€ë¦¬ ì£¼ì¸
ì´ í•„ìš”

## ì—°ê´€ê´€ê³„ê°€ í•„ìš”í•œ ì´ìœ 

> **â€˜ê°ì²´ì§€í–¥ ì„¤ê³„ì˜ ëª©í‘œëŠ” ììœ¨ì ì¸ ê°ì²´ë“¤ì˜ í˜‘ë ¥ ê³µë™ì²´ë¥¼ ë§Œë“œëŠ” ê²ƒì´ë‹¤.â€™**
> â€“ì¡°ì˜í˜¸(ê°ì²´ì§€í–¥ì˜ ì‚¬ì‹¤ê³¼ ì˜¤í•´)

## ê°ì²´ë¥¼ í…Œì´ë¸”ì— ë§ì¶”ì–´ ëª¨ë¸ë§ (ì—°ê´€ê´€ê³„ê°€ ì—†ëŠ” ê°ì²´)

- **FK(ì™¸ë˜í‚¤)** ê°€ ìˆëŠ” ìª½ì´ Nì´ë‹¤

![picture 0](./images/Basic-Relationship-Mapping-1697018129387.png)

```java filename='Member.java'

    @Entity
    public class Member {

        @Id @GeneratedValue
        private Long id;

        private Long teamId;
    }

```

```java filename='Team.java'
    @Entity
    public class Team {

        @Id @GeneratedValue
        private Long id;
    }
```

ìœ„ì™€ ê°™ì´ pkë¡œ idê°’ì„ ì§ì ‘ ê°€ì§€ê³  ìˆì„ ê²½ìš°

Memberì˜ Team ì •ë³´ë¥¼ ì•Œê³  ì‹¶ìœ¼ë©´

1. Member ë¥¼ ì¡°íšŒí•œë‹¤
2. ì¡°íšŒëœ Member ì˜ teamIdë¥¼ ê°€ì ¸ì™€ì„œ ë‹¤ì‹œ Team ì„ ì¡°íšŒí•œë‹¤

ì™€ ê°™ì´ ì¿¼ë¦¬ê°€ ë‘ë²ˆ ë°œìƒí•˜ê³  ì½”ë“œ ë¼ì¸ë„ ê¸¸ì–´ì§€ëŠ” ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.

## ê°ì²´ ì§€í–¥ ëª¨ë¸ë§ (ê°ì²´ ì—°ê´€ê´€ê³„ ì‚¬ìš©)

```java filename='Member.java'

    @Entity
    public class Member {
        @Id @GeneratedValue
        private Long id;

        @ManyToOne
        @JoinColumn(name = "id")
        private Team team;
    }

```

ì™€ ê°™ì´ ì½”ë“œë¥¼ ìˆ˜ì •í•˜ë©´ ì•„ë˜ì™€ ê°™ì´ ë³€ê²½ë©ë‹ˆë‹¤.

<Callout type="info" emoji="ğŸ§‘ğŸ»â€ğŸ’»">
  `@ManyToOne`, `@OneToMany` ê°€ í—·ê°ˆë¦´ë•Œ `To` ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì™¼ìª½ì´ **í˜„ì¬ Entity**, ì˜¤ë¥¸ìª½ì´ Join ì´ ë  **target Entity** ë¼ê³  ìƒê°í•˜ë©´ í¸í•©ë‹ˆë‹¤.

  @ManyToOne : ë‚˜ëŠ” ì—¬ëŸ¬ê°œ, ë„ˆëŠ” í•˜ë‚˜

  @OneToMany : ë‚˜ëŠ” í•˜ë‚˜ì—, ë„ˆëŠ” ì—¬ëŸ¬ê°œ
</Callout>

### ì €ì¥

```java
Member member = new Member();
em.persist(member.setTeam(new Team().setName("TeamA")));
```

ê¸°ì¡´ì—ëŠ” Team entity ì˜ì†í™” í›„ `team.getId()` ë¡œ ê°€ì ¸ì˜¨ ê°’ì„ `member.setTeamId(teamId)` ì™€ ê°™ì´ ì§„í–‰í–ˆìœ¼ë‚˜
ì´ì œëŠ” Team ê°œì²´ë¥¼ `member.setTeam(team)` ë°”ë¡œ ë„£ìœ¼ë©´ **jpaê°€ ì•Œì•„ì„œ team ê°œì²´ì˜ idê°’ì„ ê°€ì ¸ë‹¤ê°€ ì¿¼ë¦¬ë¥¼ ë§Œë“­ë‹ˆë‹¤.**

### ì¡°íšŒ

ì¡°íšŒì—ì„œë„ ë§ˆì°¬ê°€ì§€ë¡œ `member.setTeam(team)` ì„ í•œ í›„
`em.find(Member.class, member.getId());` ë¥¼ í•˜ë©´ jpaê°€ ì•Œì•„ì„œ

`ì—°ê´€ê´€ê³„` ì •ë³´ì— ë”°ë¼ `@ManyToOne` `@JoinColumn` ë‘ ì–´ë…¸í…Œì´ì…˜ì„ ì°¸ê³ í•˜ì—¬ **JoinQuery ë¥¼ ìƒì„±í•©ë‹ˆë‹¤**

### FK ë³€ê²½

ë§Œì•½ ì´ë¯¸ ì˜ì†í™”ëœ `Member` ê°œì²´ì˜ `TeamId (FK)` ë¥¼ ë³€ê²½í•˜ê³  ì‹¶ìœ¼ë©´

```java
Team newTeam = em.find(Team.class, 100L);
findMember.setTeam(newTeam);
```

í•˜ë©´ ìì—°ìŠ¤ëŸ½ê²Œ **ì—…ë°ì´íŠ¸ ì¿¼ë¦¬ê°€ ì‹¤í–‰**ë˜ë©´ì„œ `TeamId` ê°€ ë³€ê²½ë©ë‹ˆë‹¤

<Callout type="info" emoji="ğŸ§‘ğŸ»â€ğŸ’»">
  ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì— í•œë²ˆ ì˜¬ë¼ê°„ Entityì˜ ê²½ìš° Collection ì—ì„œ ê°’ì„ ê°€ì ¸ì™€ì„œ ë³€ê²½í•˜ë“¯ì´ **ì°¸ì¡°** í˜•ì‹ì´ë¼ê³  ìƒê°í•´ì•¼í•œë‹¤!
</Callout>


## ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ì™€ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ (í•µì‹¬)

### ì–‘ë°©í–¥ ë§¤í•‘

#### í…Œì´ë¸”ì—ì„œì˜ ì–‘ë°©í–¥ ë§¤í•‘

í…Œì´ë¸”ì—ì„œ **ì–‘ë°©í–¥** ì—°ê´€ê´€ê³„ëŠ” ì‚¬ì‹¤ìƒ `FK` í•˜ë‚˜ë§Œ ìˆì–´ë„ ê°€ëŠ¥í•˜ë‹¤

![picture 1](./images/Basic-Relationship-Mapping-1697022114023.png)  

ìœ„ì˜ ì´ë¯¸ì§€ì—ì„œ `Member ì—ì„œ Team ì¡°íšŒ`, ë°˜ëŒ€ë¡œ `Team ì—ì„œ Member ì¡°íšŒ` ì–‘ë°©í–¥ì´ í…Œì´ë¸”ì—ì„œ ì–´ë–»ê²Œ ê°€ëŠ¥í•œì§€ ë³´ì

**Member ì—ì„œ Team ì¡°íšŒ**
```sql
select * from Member join Team on Member.teamId = Team.id;
```

**Team ì—ì„œ Member ì¡°íšŒ**
```sql
select * from Team join Member on Team.id = Member.teamId;
```

ê²°êµ­ `FK` í•˜ë‚˜ë¡œ ì–‘ë°©í–¥ì´ ê°€ëŠ¥í•˜ë©° ë‹¨ë°©í–¥ì—ì„œì˜ ìŠ¤í‚¤ë§ˆ êµ¬ì¡° ê·¸ëŒ€ë¡œ ë³€ê²½ì—†ì´ ì–‘ë°©í–¥ ì¡°íšŒê°€ ê°€ëŠ¥í•˜ë‹¤

ê·¸ë ‡ê¸° ë•Œë¬¸ì— í…Œì´ë¸”ì—ì„œëŠ” ì‚¬ì‹¤ìƒ **`ë‹¨,ì–‘ë°©í–¥` ì´ë¼ëŠ” ê°œë…ì´ ì—†ê³ ** ê·¸ëƒ¥ **ì—°ê´€ì´ ë˜ì–´ìˆë‹¤** ë¼ëŠ” ê°œë…ë§Œ ìˆë‹¤

#### ê°ì²´ì—ì„œì˜ ì–‘ë°©í–¥ ë§¤í•‘

ë‹¨, ì–‘ë°©í–¥ì— ë”°ë¼ ìŠ¤í‚¤ë§ˆ êµ¬ì¡°ê°€ ë³€í™”ì—†ë˜ í…Œì´ë¸”ê³¼ëŠ” ë‹¬ë¦¬ ê°ì²´ì§€í–¥ì—ì„œëŠ”

ë‹¨ë°©í–¥ì—ì„œ í–ˆë˜ ê°ì²´ êµ¬ì¡°ì—ì„œ **ì½”ë“œë¥¼ ìˆ˜ì •í•´ì•¼ ì–‘ë°©í–¥ì´ ê°€ëŠ¥í•´ì§„ë‹¤**

![picture 2](./images/Basic-Relationship-Mapping-1697022559952.png)  

ìœ„ êµ¬ì¡°ì™€ ê°™ì´ `Team Entity`ì— `List members` ì™€ ê°™ì´ `member` ì˜ ì •ë³´ê°€ ë“¤ì–´ê°€ì•¼í•œë‹¤.

```java filename='Team.java'
    @Entity
    public class Team {

        @Id @GeneratedValue
        private Long id;

        @OneToMany(mappedBy = "team")
        private List<Member> members = new ArrayList<>();
    }
```

`mappedBy = "team"` í•´ì„ : ë‚˜ëŠ” **"team"** ì— ì—°ê²°ë˜ì–´ìˆë‹¤, ì—¬ê¸°ì„œ teamì€ **ìƒëŒ€ë°©ì˜ í•„ë“œ ì´ë¦„**

í…ŒìŠ¤íŠ¸ ì½”ë“œë¥¼ í•´ë³´ë©´

```java
Member findMember = em.find(Member.class, member.getId());
private List<Member> members = new ArrayList<>();
```

ê·¸ëŸ°ë°! í•œìª½ì€ `@JoinColumn(name = "id")` ìœ¼ë¡œ ë§¤í•‘í–ˆëŠ”ë° ì™œ ë‹¤ë¥¸ìª½ì€ `@OneToMany(mappedBy = "team")` ì´ë¼ê³  ì‚¬ìš©í•´ì•¼í• ê¹Œ??

## ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ê³¼ mappedBy (ì¤‘ìš”!!)

â€¢ mappedBy = JPAì˜ ë©˜íƒˆë¶•ê´´ ë‚œì´ë„
â€¢ mappedByëŠ” ì²˜ìŒì—ëŠ” ì´í•´í•˜ê¸° ì–´ë µë‹¤.
â€¢ **ê°ì²´ì™€ í…Œì´ë¸”ê°„ì— ì—°ê´€ê´€ê³„ë¥¼ ë§ºëŠ” ì°¨ì´ë¥¼ ì´í•´í•´ì•¼ í•œë‹¤.**

### ê°ì²´ì™€ í…Œì´ë¸”ì´ ê´€ê³„ë¥¼ ë§ºëŠ” ì°¨ì´

â€¢ **ê°ì²´ ì—°ê´€ê´€ê³„ = 2ê°œ**
    â€¢ íšŒì› `-->` íŒ€ ì—°ê´€ê´€ê³„ **1ê°œ(ë‹¨ë°©í–¥)**
    â€¢ íŒ€ `-->` íšŒì› ì—°ê´€ê´€ê³„ **1ê°œ(ë‹¨ë°©í–¥)**

ì‚¬ì‹¤ ì–‘ë°©í–¥ì´ë¼ëŠ” ë§ ë³´ë‹¤ëŠ” **ë‹¨ë°©í–¥ ê´€ê³„ê°€ ë‘ê°œ** ë¼ëŠ” ë§ì´ ë” ë§ë‹¤

![picture 3](./images/Basic-Relationship-Mapping-1697023552126.png)  



â€¢ **í…Œì´ë¸” ì—°ê´€ê´€ê³„ = 1ê°œ**
    â€¢ íšŒì› `<-->` íŒ€ì˜ ì—°ê´€ê´€ê³„ **1ê°œ(ë°©í–¥ì´ ì—†ë‹¤!)**

ìœ„ì—ì„œ ì•Œì•„ë´¤ë˜ ê²ƒ ì²˜ëŸ¼ í…Œì´ë¸”ì—ì„œëŠ” **FK í•œê°œ** ë¡œ ì–‘ë°©í–¥ì„ ë‚˜íƒ€ë‚¼ ìˆ˜ ìˆë‹¤

![picture 4](./images/Basic-Relationship-Mapping-1697023627876.png) 

### ê°ì²´ì˜ ì–‘ë°©í–¥ ê´€ê³„

â€¢ ê°ì²´ì˜ ì–‘ë°©í–¥ ê´€ê³„ëŠ” ì‚¬ì‹¤ ì–‘ë°©í–¥ ê´€ê³„ê°€ ì•„ë‹ˆë¼ **ì„œë¡œ ë‹¤ë¥¸ ë‹¨ë±¡í–¥ ê´€ê³„ 2ê°œë‹¤.**

â€¢ ê°ì²´ë¥¼ ì–‘ë°©í–¥ìœ¼ë¡œ ì°¸ì¡°í•˜ë ¤ë©´ **ë‹¨ë°©í–¥ ì—°ê´€ê´€ê³„ë¥¼ 2ê°œ** ë§Œë“¤ì–´ì•¼ í•œë‹¤.

â€¢ A -> B (a.getB())
â€¢ B -> A (b.getA())

```java
class A {
    B b;
}

class B {
    A a;
}
```


### í…Œì´ë¸”ì˜ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„

â€¢ í…Œì´ë¸”ì€ **ì™¸ë˜ í‚¤ í•˜ë‚˜**ë¡œ ë‘ í…Œì´ë¸”ì˜ ì—°ê´€ê´€ê³„ë¥¼ ê´€ë¦¬

â€¢ MEMBER.TEAM_ID **ì™¸ë˜ í‚¤ í•˜ë‚˜ë¡œ ì–‘ë°©í–¥ ì—°ê´€ê´€ê³„ ê°€ì§**(ì–‘ìª½ìœ¼ë¡œ ì¡°ì¸í•  ìˆ˜ ìˆë‹¤.)

```sql
select * from Member M join TEAM T on M.TEAM_ID = T.TEAM_ID
```
```sql
select * from Team T join Member M on T.TEAM_ID = M.TEAM_ID
```

### ë‘˜ ì¤‘ í•˜ë‚˜ë¡œ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬í•´ì•¼ í•œë‹¤.

![picture 5](./images/Basic-Relationship-Mapping-1697024674912.png)  

**íšŒì›**ì´ ì†Œì†ëœ **íŒ€** ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œ
ì´ë¥¼ ì½”ë“œë¡œ ë°˜ì˜í•˜ë ¤ë©´

`Team`ì˜ `members`ë¥¼ ë³€ê²½í•´ë„ ë˜ê³ 
ë°˜ëŒ€ë¡œ
`Member`ì˜ `team`ì„ ë³€ê²½í•´ë„ ë©ë‹ˆë‹¤.

ë‘˜ë‹¤ ë³€ê²½í•´ë„ ê²°ê³¼ê°€ ê°™ë‹¤ë©´ ì–´ë–¤ê±¸ë¡œ ë³€ê²½í• ì§€ **ì„ íƒ ì¥ì• **ê°€ ì˜µë‹ˆë‹¤.

ì´ë•Œ **ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸(Owner)** ì˜ ê°œë…ì´ ë‚˜ì˜µë‹ˆë‹¤.

### ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸(Owner)

**ì–‘ë°©í–¥ ë§¤í•‘ ê·œì¹™**
â€¢ ê°ì²´ì˜ ë‘ ê´€ê³„ì¤‘ í•˜ë‚˜ë¥¼ ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ìœ¼ë¡œ ì§€ì •
â€¢ **ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ë§Œì´ ì™¸ë˜ í‚¤ë¥¼ ê´€ë¦¬(ë“±ë¡, ìˆ˜ì •)**
â€¢ **ì£¼ì¸ì´ ì•„ë‹Œìª½ì€ ì½ê¸°ë§Œ ê°€ëŠ¥**
â€¢ ì£¼ì¸ì€ mappedBy ì†ì„± ì‚¬ìš©X
â€¢ ì£¼ì¸ì´ ì•„ë‹ˆë©´ mappedBy ì†ì„±ìœ¼ë¡œ ì£¼ì¸ ì§€ì •

ë‹¤ì‹œ í•œë²ˆ `mappedBy` ë¼ëŠ” ì˜ì–´ë¥¼ í•´ì„í•´ë³´ë©´ `mapped` ë§µí•‘ ë˜ì—ˆë‹¤, `By` byì— ì˜í•´ ì¦‰, `ë‚˜ëŠ” ì£¼ì¸ì—ì˜í•´ ë§µí•‘ë˜ì—ˆë‹¤!` ë¼ëŠ” í•´ì„ì´ ê°€ëŠ¥í•˜ë‹¤


