# elasticsearch 에서 사용하는 캐싱들을 알아보자

공홈에서 설명하는 캐시 : https://www.elastic.co/kr/blog/elasticsearch-caching-deep-dive-boosting-query-speed-one-cache-at-a-time

## 페이지 캐시

**운영 체제 레벨의 캐시**이다

페이지란, **프로세스가 할당받는 가상 메모리 공간을 균일한 크기로 나눈 메모리 영역을 지칭한다.**

그렇다면 페이지 캐시란 무엇인가?

CPU 는 보조기억장치에서 바로 데이터를 읽는게 아니라 메모리에서 읽어온다

이때 접근하려는 페이지가 물리 메모리에 Load 되어있지 않을 경우 `페이지 폴트(Page Fault)` 가 발생하는데 하드 디스크(윈도우는 pagefile.sys, 리눅스는 swap 영역) 의 페이지를 물리 메모리로 Load 한다(Page In) 그 이후에 이 로드된 페이지로 부터 데이터를 읽게되는데, 이렇게 Load 된 페이지들은 OS의 관리하에 자주 사용되는 페이지의 경우 물리 메모리 영역에 좀 더 오래 유지되고 자주 안쓰는 페이지는 다시 디스크 영역으로 내리는 일련의 관정들이 발생한다.

이렇게 CPU 가 저장된 데이터에 더 빠르게 접근하도록 하기 위하여 물리 메모리에 페이지를 로드하고 관리하는 것을 `페이지 캐시` 라고 한다
 
단순하게 요약하면 `보조기억장치의 데이터를 더 빠르게 접근하기 위해 페이지 단위로 물리 메모리에 올려놓고 쓰는 것`
 
### 제거 시점

운영체제가 알아서 함
 
### 특징

운영체제가 관리하기 때문에 커널 메모리 영역을 사용하게된다
elasticsearch 실행시 할당하는 jvm heap 영역과는 상관없다.
그러기 때문에 elasticsearch 실행 시 [heap 영역을 최대 현재 호스트 pc의 반](https://www.elastic.co/guide/en/elasticsearch/reference/7.11/tune-for-search-speed.html#_give_memory_to_the_filesystem_cache_2)으로 권장한다.
나머지 반은 페이지 캐시를 위한 커널 메모리 영역으로 남겨놔야하기 때문이다.

만약 대부분의 메모리를 elasticsearch heap으로 할당하게되면 페이지 캐시의 성능이 저하될 것이다

---

## 샤드 레벨 요청 캐시

집계로만 구성된 검색 결과를 캐시함


## 쿼리 캐시

---

opster 에서 설명하는 캐시 : https://opster.com/guides/elasticsearch/glossary/elasticsearch-cache/

## 노드 요청 캐시

노드 요청 캐시는 필터 컨텍스트에 사용된 쿼리 결과를 유지한다
결과는 가장 최근에 사용된 항목을 기준으로 제거된다

## 샤드 데이터 캐시

샤드 데이터 캐시는 크기

## 필드 데이터 캐시

---
